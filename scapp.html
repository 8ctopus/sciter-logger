<html
    window-resizable="true"
    window-width="600dip"
    window-height="400dip"
>
<head>
<title>sciter logger demo</title>
<style>

plaintext#logger {
    size: *;
}

@import url(src/logger.css)

</style>
<script type="module">

import {logger} from "src/logger.js";
import {addReloadWindow, centerWindow} from "vendor/8ctopus/sciter-utils/src/utils.js";

document.on("ready", function() {
    try {
        // add support for F5 reload
        addReloadWindow();

        // center window on screen
        centerWindow();

        // get file url
        const url = __DIR__ + "test.log";

        // get file path
        const path = URL.toPath(url);

        //console.log(`url - ${url}\npath - ${path}`);
        console.log("logger init...");

        // initialize logger
        logger.init(path, true);

        console.log("logger init - OK");

        const plaintext = document.$("plaintext#logger");

        // subscribe to logger messages
        logger.subscribe(function(level, message) {
            plaintext.append(JSX(level, {}, [message]));

            // scroll to last item
            plaintext.lastElementChild.scrollIntoView({behavior: "smooth"});
        });

        console.log("logger attach...");

        // attach logger to console
        logger.attach();

        console.log("logger attach - OK");

        // capture unhandled exceptions
        logger.capture();

        logger.debug();

        // test logger
        console.log("log");
        console.warn("warning");
        console.error("error");
        console.debug("debug");

        // test handled exception
        throw new Error("handled exception");
    }
    catch (e) {
        console.error(`${e.message} ${e.stack}`);
    }

    // test unhandled exception
    throw new Error("unhandled exception");
});

document.on("click", "button#window", function() {
    console.log("create new window");

    var wnd = new Window({
        parent: Window.this,
        url   : __DIR__ + "window.html",
        state : Window.WINDOW_SHOWN,
    });
});

</script>
</head>
<body>
    <button #window>test logger in new window</button>
    <plaintext #logger readonly />
</body>
</html>
