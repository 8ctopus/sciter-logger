<html
    window-resizable="true"
    window-width="600dip"
    window-height="400dip"
>
<head>
<title>sciter logger demo</title>
<style>

iframe {
    height: 15%;
}

plaintext#logger {
    size: *;
}

@import url(src/logger.css);

</style>
<script type="module">

import {logger} from "src/logger.js";
import * as utils from "vendor/8ctopus/sciter-utils/src/utils.js";
import {test} from "js/test.js";

document.on("ready", function(event, element) {
    try {
        // do not handle iframe ready
        if (element.parentElement)
            return;

        // add support for F5 reload
        utils.addReloadWindow();

        // close window on escape key press
        utils.closeWindowOnEscape();

        // center window on screen
        utils.centerWindow("screen");

        // bring window to front
        utils.windowToFront();

        // get file url
        const url = __DIR__ + "test.log";

        // get file path
        const path = URL.toPath(url);

        //console.log(`url - ${url}\npath - ${path}`);
        console.log("logger init...");

        // initialize logger
        logger.init(path, true);

        console.log("logger init - OK");

        // redirect logger output to plaintext
        logger.plaintext(document.$("plaintext#logger"));

        console.log("logger attach...");

        // attach logger to console
        logger.attach();

        console.debug("logger attach - OK");

        // capture unhandled exceptions
        logger.capture();

        logger.debug();

        // log sciter version
        console.debug(utils.sciterInfo());

        // test logger
        console.debug("debug");
        console.log("log");
        console.line();
        console.note("note");
        console.warn("warning");
        console.error("error");
        console.exception("exception");

        // log object
        console.log({
            a: 1,
            b: {
                alpha: "test",
                beta: "yet another test"
            },
            c: 3,
        });

        test();

        // test handled exception
        throw new Error("main handled exception");
    }
    catch (e) {
        console.exception(`${e.message} ${e.stack}`);
    }

    // test unhandled exception
    throw new Error("main unhandled exception");
});

document.on("click", "button#window", function() {
    console.log("create new window...");

    new Window({
        parent: Window.this,
        url   : __DIR__ + "window.html",
        state : Window.WINDOW_SHOWN,
        alignment: 6,
        width: 300,
        height: 200,
    });
});

</script>
<script type="module">

import {logger} from "src/logger.js";
import {test} from "js/test.js";

// logger not attached to console yet as it happens in document ready
console.log(`logger attached to console - ${logger.isAttached()}`);

document.on("click", "button#module", function() {
    // logger attached because document ready is complete
    console.log(`logger attached to console - ${logger.isAttached()}`);

    test();
});

</script>
</head>
<body>
    <button #window>test logger in new window</button>
    <button #module>test logger in new module</button>
    <iframe src="iframe.html" />
    <plaintext #logger readonly />
</body>
</html>
