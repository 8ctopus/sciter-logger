<html
    window-resizable="true"
    window-width="500dip"
    window-height="300dip"
>
<head>
<title>sciter logger demo</title>
<style>

plaintext#logger {
    size: *;
}

log {
    width: *;
    padding-left: 4dip;
    color: rgb(40,40,40);
}

warn {
    width: *;
    padding-left: 4dip;
    color: orange;
}

error {
    width: *;
    padding-left: 4dip;
    color: red;
    //font-weight: bold;
}

</style>
<script src="js/utils.js" />
<!--script src="js/logger.js" /-->
<script type="module">

import {logger} from "src/logger.js";

document.on("ready", function() {
    try {
        // get file url
        const url = __DIR__ + "test.log";

        // get file path
        const file = URL.toPath(url);

        //console.log(`url - ${url}\nfile - ${file}`);

        // initialize logger
        logger.init(file, true);

        const plaintext = document.$("plaintext#logger");

        // subscribe to logger messages
        logger.subscribe(function(level, message) {
            let jsx = "";

            switch (level) {
                default:
                case "log":
                    jsx = <log>{message}</log>;
                    break;

                case "warn":
                    jsx = <warn>{message}</warn>;
                    break;

                case "error":
                    jsx = <error>{message}</error>;
                    break;
            }

            plaintext.append(jsx);
        });

        // attach logger to console
        logger.attach();

        // capture unhandled exceptions
        logger.capture();

        logger.debug();

        // test logger
        console.log("new logger test");
        console.warn("warning");
        console.error("error");
    }
    catch (e) {
        console.log(`${e.message} ${e.stack}`);
    }
});

document.on("click", "button", function() {
    console.log("create new window");

    var wnd = new Window({
        parent: Window.this,
        url   : __DIR__ + "window.html",
        state : Window.WINDOW_SHOWN
    });
});

</script>
</head>
<body>
    <button />
    <plaintext #logger readonly />
</body>
</html>
